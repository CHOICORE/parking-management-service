# Parking Management System

버전 : 0.1.0
---

차량 입출차 정보를 기록하고 이용 요금을 계산하는 시스템

## 주요 기능

1. 차량 입출차 정보 관리
    1. 입차 정보 등록
    2. 출차 정보 등록
    3. 입출차 정보 조회
    4. 입출차 정보 수정
    5. 입출차 정보 삭제

## 입차 정보 등록

- 목적: 차량 입차 정보를 등록하고, 주차 관리 시스템에서 추후 요금 계산 및 출차 시 활용할 수 있도록 한다.
- 사용자 : LPR/ANPR 시스템
- 사전조건 :
    - 계약을 통해 사용자 등록이 완료되어 있어야 한다.
    - 발급 받은 API Key 를 사용하여 인증이 되어야 한다.
- 입력 :
    - 차량 번호
    - API Key
- 출력 :
    - 입차 정보 식별 고유 키 `Access Key`를 발급한다.

- 예외 :
    - API Key 가 없는 경우, 유효하지 않은 경우
    - 차량 번호가 유효하지 않은 경우

## 출차 정보 등록

- 목적: 입차했던 차량의 출차 정보를 등록하고, 주차 요금을 정산할 때 활용할 수 있도록 한다.
- 사용자: LPR/ANPR 시스템
- 사전조건:
    - 계약을 통해 사용자 등록이 완료되어 있어야 한다.
    - 발급 받은 API Key를 사용하여 인증이 되어야 한다.
    - 입차 정보가 등록되어 있어야 한다.
    - 입차 정보의 식별 고유 키가 있어야 한다.
        - 입차 정보 식별 고유 키는 입차 시 발급된 `Access Key`이다.
    - 입차 정보의 차량 번호와 출차 차량 번호가 일치해야 한다.
- 입력:
    - `Access Key`
    - 차량 번호
    - 출차 시간 (yyyy-MM-dd HH:mm-ss)
- 출력:
    - 출차 정보가 성공적으로 등록되었다는 확인 메시지
    - 계산된 주차 요금 (필요 시)
- 예외:
    - API Key가 없는 경우, 유효하지 않은 경우
    - `Access Key`로 조회했을 때, 입차 정보가 없는 경우
    - 입차 정보의 차량 번호와 출차 차량 번호가 일치하지 않는 경우

## 입출차 시나리오

### Case 1. 정상 시나리오

개요: 차량이 입차 후 출차하는 시나리오

1. 123가4567 -> 2024-08-21 10:00 입차 - `Access Key` 발급 (e.g. accessKey: qybxC4OKeUT1x6QYoqMxw)
2. 123가4567 -> 2024-08-21 10:20 출차 - `Access Key`로 입차 정보를 찾아 출차 정보 등록 완료 (e.g. 2024-08-21 10:00 ~ 2024-08-21 10:20)

| 레코드 번호 | 차량 번호    |        입차        |        출차        |         고유 키          | ... |
|:------:|:---------|:----------------:|:----------------:|:---------------------:|:---:|
|   1    | 123가4567 | 2024-08-21 10:00 | 2024-08-21 10:20 | qybxC4OKeUT1x6QYoqMxw | ... |

### Case 2. 비정상 시나리오

개요: 시스템 상으로 출차를 시도하여, 출차정보가 전송되었지만 어떠한 이유로 주차장을 떠나지 않고 재 출차를 시도하는 경우

1. 123가4567 -> 2024-08-21 10:00 입차 - `Access Key` 발급 (e.g. accessKey: qybxC4OKeUT1x6QYoqMxw)
2. 123가4567 -> 2024-08-21 10:20 출차 - `qybxC4OKeUT1x6QYoqMxw`로 입차 정보를 찾아 출차 정보 등록 완료
3. 123가4567 -> 2024-08-21 10:30 출차 - `qybxC4OKeUT1x6QYoqMxw`로 입차 정보를 찾았지만 이미 출차 정보가 등록되어 있음

해결 방안:

1. 이미 출차 정보가 등록되어 있다는 메시지를 출력하고 출차 정보를 등록하지 않도록 한다.
    - 증적 자료로 요청 기록은 남기되, 출차 정보를 등록하지 않도록 한다.
2. 관리자가 출차 정보를 확인하여, 출차 정보를 삭제하거나 수정할 수 있도록 한다.
    - 관리자가 확인 후, 입차 정보를 등록할 때, 수정 사유와 함께 등록할 수 있도록 하고, 수정 이력을 기록한다.
3. `Access Key:qybxC4OKeUT1x6QYoqMxw`로 등록된 출차 시간을 입차 정보로 활용하여 출차 정보를 추가 등록한다.
   (e.g. 2024-08-21 10:20 ~ 2024-08-21 10:30)
    - 추가 등록 시 새로운 `Access Key:Sks2fHiGPlJW756Z1TgNF`를 발급한다.
    - 레코드를 추적할 수 있는 원본 `Access Key:qybxC4OKeUT1x6QYoqMxw`를 함께 저장한다.

| 레코드 번호 | 차량 번호    |        입차        |        출차        |      access_key       |      derived_key      | ... |
|:------:|:---------|:----------------:|:----------------:|:---------------------:|:---------------------:|:---:|
|   1    | 123가4567 | 2024-08-21 10:00 | 2024-08-21 10:20 | qybxC4OKeUT1x6QYoqMxw |         null          | ... |
|   2    | 123가4567 | 2024-08-21 10:20 | 2024-08-21 10:30 | Sks2fHiGPlJW756Z1TgNF | qybxC4OKeUT1x6QYoqMxw | ... |

### Case 3. 비정상 시나리오

개요: 사용자 시스템에서 `Access key`를 잃어버려 출차 정보를 등록할 수 없는 경우

해결 방안:

1. 입차 정보를 찾을 수 없다는 메시지를 출력하고, 출차 정보를 등록하지 않도록 한다.
    - 증적 자료로 요청 기록은 남기되, 출차 정보를 등록하지 않도록 한다.
2. 출차 정보를 등록하고 관리자가 확인하여, 입차 정보를 등록할 수 있도록 한다.
    - 관리자가 확인 후, 입차 정보를 등록할 때, 수정 사유와 함께 등록할 수 있도록 하고, 수정 이력을 기록한다.
